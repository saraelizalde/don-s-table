{% extends "base.html" %}

{% load i18n %}

{% block head_title %}{% trans "Signup" %}{% endblock head_title %}

{% block hero_content %}
<!-- empty block: overrides base block, so nothing shows -->
{% endblock %}

{% block content %}

<div class="logged-info">
    {% if user.is_authenticated %}
    <p class="text-end m-3">You are logged in as {{ user }}</p>
    {% else %}
    <p class="text-end m-3">You are not logged in</p>
    {% endif %}
</div>

{% if messages %}
{% for message in messages %}
<div class="messages-container">
    {% for message in messages %}
    <div class="message {{ message.tags }}">{{ message }}</div>
    {% endfor %}
</div>
{% endfor %}
{% endif %}

<section class="account-page">
    <h2>My Reservations</h2>

    {% if messages %}
    <div class="messages">
        {% for message in messages %}
        <div class="alert {{ message.tags }}">
            {{ message }}
        </div>
        {% endfor %}
    </div>
    {% endif %}

    {% for r in reservations %}
    <div class="reservation-card">
        <p>
            {{ r.date }} at {{ r.time }} â€” {{ r.guests }} guests
            <strong>Status: {{ r.get_status_display }}</strong>
        </p>
        {% if r.special_requests %}
        <p><em>Special Requests: {{ r.special_requests }}</em></p>
        {% endif %}
        <p>
        <form action="{% url 'edit_reservation' r.id %}" method="get" style="display:inline;">
            <button type="submit">Edit</button>
        </form>
        <form method="POST" action="{% url 'cancel_reservation' r.id %}" class="cancel-form">
            {% csrf_token %}
            <button type="button" class="cancel-btn btn-danger" data-id="{{ r.id }}">Cancel</button>
        </form>
        </p>
    </div>

    {% empty %}
    <p>You have no reservations.</p>
    {% endfor %}

    <p><a href="{% url 'make_reservation' %}">Make a new reservation</a></p>
</section>

<!-- Cancel Confirmation Modal -->
<div id="cancelModal" class="modal">
    <div class="modal-content">
        <h2>Cancel Reservation</h2>
        <p>Are you sure you want to cancel this reservation?</p>
        <div class="modal-actions">
            <button id="confirmCancel" class="btn-cancel">Yes, Cancel</button>
            <button id="closeModal" class="btn-secondary">No, Go Back</button>
        </div>
    </div>
</div>

{% endblock %}